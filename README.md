# Полётное задание

**Проект для планирования маршрутов с учётом запретных зон и рельефа местности**

## Описание

Веб-приложение на основе Next.js и React позволяет строить оптимальный маршрут между двумя точками с учётом:

* **No-fly зоны**: пользователь может рисовать полигоны на карте, задавая зоны, которые нужно обходить.
* **Рельеф**: расчет маршрута учитывает изменение высоты местности по данным DEM-тайлов от MapTiler.
* **Ширина коридора**: отображение буфера вокруг маршрута для оценки безопасной зоны пролёта.

Интерфейс использует MapLibre GL для визуализации спутниковых тайлов, Geoman для рисования на карте и Ant Design для UI.

## Основные возможности

* Выбор начала и конца маршрута с помощью крестовины или ручного ввода координат.
* Задание и редактирование no-fly зон (полигоны).
* Расчёт оптимального маршрута с обходом запретных зон и учётом подъёмов/спусков.
* Визуализация маршрута и коридора безопасного пролёта.
* Редактирование маршрута с помощью Geoman после построения.

## Технологический стек

* **React** / **Next.js** (SSR + маршрутизация)
* **MapLibre GL** — картографическая библиотека
* **@geoman-io/maplibre-geoman-free** — инструменты рисования на карте
* **Ant Design** — компоненты интерфейса
* **Turf.js** — геопространственные операции (буфер, длина, пересечения и т. д.)
* **Node.js** (API-роуты)
* **Canvas**, **node-fetch**, **turf** и **Heap** — для серверной части расчёта маршрута

## Начало работы

### Предварительные требования

* Node.js `>=14.x`
* `yarn` или `npm`
* API-ключ [MapTiler](https://www.maptiler.com)

### Установка

1. Клонируйте репозиторий:

   ```bash
   git clone <url-репозитория>
   cd flight-mission
   ```
2. Установите зависимости:

   ```bash
   yarn install
   # или
   npm install
   ```

### Переменные окружения

Создайте файл `.env.local` в корне проекта и добавьте:

```env
NEXT_PUBLIC_MAPTILER_KEY=<ваш_ключ_MapTiler>
```

(используется для загрузки спутниковых и DEM-тайлов)

### Запуск локально

```bash
# Для разработки
yarn dev
# или
npm run dev
# Перейти по адресу http://localhost:3000
```

Для продакшена:

```bash
yarn build
yarn start
```

## Структура проекта

```
├── components/
│   └── MapComponent.jsx   # Основной компонент карты и UI панели
├── pages/
│   ├── api/route.js       # API-роут для расчёта маршрута
│   ├── _app.jsx           # Настройка Ant Design и ProLayout
│   └── index.jsx          # Главная страница с проксированным MapComponent
├── utils/
│   ├── routeUtils.js      # Логика построения маршрута (DEM, граф, Dijkstra)
│   └── terrain.js         # Вспомогательные функции для выборки высоты
├── public/
│   └── logo.png           # Логотип приложения
├── styles/
│   └── globals.css        # Глобальные стили
├── .env.local             # Переменные окружения (не в репозитории)
└── README.md              # Текущий файл
```

## API

### `POST /api/route`

Запрашивает оптимальный маршрут.

**Тело запроса (JSON):**

| Поле            | Тип                      | Описание                                 |
| --------------- | ------------------------ | ---------------------------------------- |
| `start`         | `[number, number]`       | Координаты \[долгота, широта] начала     |
| `end`           | `[number, number]`       | Координаты \[долгота, широта] конца      |
| `noFlyZones`    | `Array<GeoJSON.Polygon>` | Массив полигона запрещённых зон          |
| `corridorWidth` | `number`                 | Ширина буфера вокруг маршрута (в метрах) |

**Ответ (200 OK):**

```json
{
  "route": GeoJSON.LineString,
  "corridor": GeoJSON.Polygon
}
```

## Развертывание

1. Настроить переменные окружения на сервере (`MAPTILER_KEY`).
2. Собрать и запустить приложение:

   ```bash
   yarn install
   yarn build
   yarn start
   ```
3. Настроить обратный прокси (например, Nginx) на порт `3000`.

## Контрибьюция

1. Форкните репозиторий.
2. Создайте фичевую ветку (`git checkout -b feature/your-feature`).
3. Сделайте коммит (`git commit -m 'Добавил новую фичу'`).
4. Запушьте ветку (`git push origin feature/your-feature`).
5. Откройте Pull Request.

## Лицензия

MIT © 2025
